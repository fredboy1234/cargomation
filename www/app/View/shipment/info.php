<?php
$transImage = "";
$transMode = strtolower($this->shipment_info[0]->transport_mode);
switch ($transMode) {
    case 'sea':
        $transImage = "M1320 5720 l0 -320 -301 0 c-316 0 -329 -2 -329 -45 0 -22 -281 -679 -292 -683 -4 -2 -8 -12 -8 -22 0 -10 -4 -20 -10 -22 -5 -1 -14 -23 -19 -48 -5 -25 -37 -120 -70 -212 -119 -327 -164 -544 -164 -798 0 -256 36 -436 159 -795 41 -121 78 -232 81 -248 3 -15 9 -27 14 -27 5 0 9 -10 9 -22 0 -13 7 -36 16 -53 17 -33 261 -631 278 -682 6 -18 14 -33 18 -33 5 0 8 -7 8 -15 0 -13 41 -15 305 -15 l305 0 0 -290 0 -290 405 0 405 0 0 290 0 290 3510 0 3510 0 29 28 c16 15 161 103 323 196 623 361 1044 620 1308 806 67 47 142 100 168 117 26 18 79 61 117 95 197 176 309 313 355 435 28 72 37 185 20 261 -28 132 -149 307 -313 454 -50 45 -99 90 -108 100 -9 10 -19 18 -22 18 -3 0 -63 44 -133 97 -245 184 -646 442 -1289 828 -209 126 -384 235 -388 242 -4 7 -16 13 -27 13 -10 0 -20 6 -22 13 -4 9 -719 13 -3521 15 l-3517 2 0 320 0 320 -405 0 -405 0 0 -320z m6760 -1005 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-5140 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m400 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m380 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m2470 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m450 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m1830 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-2740 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m1460 -230 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m390 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-2430 -80 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-860 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m430 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m5007 -141 c151 -31 260 -90 368 -199 283 -286 231 -746 -110 -974 -351 -234 -843 -112 -1025 255 -66 132 -85 268 -56 404 76 357 451 591 823 514z m-1647 -279 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-4340 -20 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m4760 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-5590 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m420 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m3330 -40 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-980 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m510 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m1420 -420 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-2470 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m2070 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-2510 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-440 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-530 -320 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-410 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-430 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m5180 -160 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m400 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-1800 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-1000 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m480 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-970 -290 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-500 -20 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-450 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m2940 -110 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m410 0 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-3850 -160 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-410 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205z m-450 -10 l0 -205 -125 0 -125 0 0 205 0 205 125 0 125 0 0 -205zM9435 3788 c-3 -8 -4 -97 -3 -198 l3 -185 40 0 40 0 3 83 3 82 74 0 75 0 0 -86 0 -85 38 3 37 3 0 195 0 195 -37 3 -38 3 0 -80 0 -81 -75 0 -74 0 -3 78 -3 77 -38 3 c-24 2 -39 -1 -42 -10z";
        $transTitle = "Voyage";
        break;
    case 'air':
        $transImage = "m2,106h28l24,30h72l-44,-133h35l80,132h98c21,0 21,34 0,34l-98,0 -80,134h-35l43,-133h-71l-24,30h-28l15,-47";
        $transTitle = "Flight";
        break;    
    default:
        $transImage = "M34.533,390.596c-10.214,8.754-17.231,21.053-19.316,35.02H6.949c-3.822,0-6.949-3.127-6.949-6.949v-21.123   c0-3.822,3.126-6.947,6.949-6.947H34.533L34.533,390.596z M114.159,425.615c0.556,2.709,0.834,5.418,0.834,8.268   c0,23.832-19.316,43.217-43.218,43.217c-23.832,0-43.218-19.385-43.218-43.217c0-2.85,0.277-5.559,0.833-8.268   c3.821-19.943,21.331-35.02,42.384-35.02S110.407,405.672,114.159,425.615z M93.384,433.883c0-2.918-0.555-5.768-1.667-8.268   c-3.196-7.852-10.909-13.342-19.941-13.342c-9.033,0-16.745,5.49-19.942,13.342c-1.112,2.5-1.667,5.35-1.667,8.268   c0,11.881,9.658,21.609,21.609,21.609C83.727,455.492,93.384,445.764,93.384,433.883z M17.106,362.873V155.745   c0-11.512,9.333-20.845,20.845-20.845h332.125c11.513,0,20.845,9.333,20.845,20.845v207.128c0,3.82-3.126,6.947-6.948,6.947H24.055   C20.233,369.82,17.106,366.693,17.106,362.873z M340.476,339.488c0,3.299,2.674,5.973,5.973,5.973h0.186   c3.298,0,5.972-2.674,5.972-5.973V167.625c0-3.298-2.674-5.972-5.972-5.972h-0.186c-3.299,0-5.973,2.674-5.973,5.972V339.488z    M284.314,339.488c0,3.299,2.673,5.973,5.971,5.973h0.186c3.299,0,5.972-2.674,5.972-5.973V167.625   c0-3.298-2.673-5.972-5.972-5.972h-0.186c-3.298,0-5.971,2.674-5.971,5.972V339.488z M228.151,339.488   c0,3.299,2.674,5.973,5.972,5.973h0.186c3.298,0,5.972-2.674,5.972-5.973V167.625c0-3.298-2.674-5.972-5.972-5.972h-0.186   c-3.298,0-5.972,2.674-5.972,5.972V339.488z M171.99,339.488c0,3.299,2.674,5.973,5.972,5.973h0.186   c3.298,0,5.972-2.674,5.972-5.973V167.625c0-3.298-2.674-5.972-5.972-5.972h-0.186c-3.298,0-5.972,2.674-5.972,5.972V339.488z    M115.828,339.488c0,3.299,2.673,5.973,5.972,5.973h0.186c3.298,0,5.971-2.674,5.971-5.973V167.625   c0-3.298-2.673-5.972-5.971-5.972H121.8c-3.299,0-5.972,2.674-5.972,5.972V339.488z M59.666,339.488   c0,3.299,2.674,5.973,5.972,5.973h0.186c3.299,0,5.972-2.674,5.972-5.973V167.625c0-3.298-2.673-5.972-5.972-5.972h-0.186   c-3.298,0-5.972,2.674-5.972,5.972V339.488z M220.815,425.615c0.556,2.709,0.834,5.418,0.834,8.268   c0,23.832-19.316,43.217-43.218,43.217c-23.833,0-43.218-19.385-43.218-43.217c0-2.85,0.278-5.559,0.833-8.268   c3.822-19.943,21.332-35.02,42.385-35.02S217.063,405.672,220.815,425.615z M200.04,433.883c0-2.918-0.556-5.768-1.598-8.268   c-3.266-7.852-10.979-13.342-20.011-13.342s-16.746,5.49-20.011,13.342c-1.042,2.5-1.598,5.35-1.598,8.268   c0,11.881,9.658,21.609,21.61,21.609C190.382,455.492,200.04,445.764,200.04,433.883z M141.188,390.596h-32.169   c7.087,6.113,12.715,13.965,16.12,22.859C128.473,404.562,134.101,396.709,141.188,390.596z M612,397.543v21.123   c0,3.822-3.127,6.949-6.948,6.949h-56.28c-4.03-27.586-27.724-48.916-56.42-48.916s-52.459,21.33-56.489,48.916H234.989   c-2.084-13.967-9.102-26.266-19.316-35.02H410.78V191.876c0-7.644,6.183-13.897,13.896-13.897h65.592   c18.482,0,35.714,9.172,46.065,24.458l42.315,62.673c6.184,9.172,9.519,20.011,9.519,31.058v94.427h16.884   C608.873,390.596,612,393.721,612,397.543z M541.545,266.708l-33.838-48.082c-1.32-1.806-3.404-2.918-5.697-2.918h-52.736   c-3.821,0-6.949,3.126-6.949,6.949v48.012c0,3.891,3.128,6.948,6.949,6.948h86.574   C541.477,277.617,544.741,271.294,541.545,266.708z M535.569,433.883c0,23.832-19.385,43.217-43.218,43.217   c-23.902,0-43.218-19.385-43.218-43.217c0-23.902,19.316-43.287,43.218-43.287C516.185,390.596,535.569,409.98,535.569,433.883z    M513.961,433.883c0-11.951-9.658-21.609-21.609-21.609s-21.609,9.658-21.609,21.609c0,11.881,9.658,21.609,21.609,21.609   S513.961,445.764,513.961,433.883z";
        $transTitle = "Voyage/Flight";
        break;
} 
// Universal checker for empty data value
foreach ($this->shipment_info[0] as $key => $value) {
    if(empty($value) || $value == NULL) {
        $this->shipment_info[0]->$key = "-";
    }
}
?>
<div class="row">
    <div class="col-lg-3">
         <h1 class="p-3 mt-2 shipment-num" data-toggle="tooltip" data-placement="bottom" title="<?= $this->shipment_info[0]->shipment_num; ?>"> <?= $this->shipment_info[0]->shipment_num; ?></h1>    
    </div>
    <div class="col-lg-9">
        <div>
            <div class="row">
                <div class="col-lg-3 col-6">
                    <div class="small-box">
                        <div class="inner">
                            <strong><i class="fas fa-check-double text-primary"></i> Status</strong>
                            <p>
                            <?php
                                $current_date = new DateTime();
                                $eta_date = new DateTime($this->shipment_info[0]->eta);
                                $current_date = $current_date->getTimestamp();
                                $eta_date = $eta_date->getTimestamp();

                                switch ($eta_date) {
                                    case ($eta_date > $current_date):
                                        echo "In Transit" . ' <i class="fas fa-shipping-fast text-primary"></i>'; // icon clock
                                        break;
                                    case (false):
                                        echo '<i class="fas fa-plane-arrival"></i> ' . "At Destination Port"; // icon marker alt
                                        break;
                                    case (false):
                                        echo '<i class="fas fa-plane-departure"></i> ' . "At Origin Port"; // icon marker
                                        break;
                                    case (false):
                                        echo '<i class="far fa-clock"></i>' . "Coordinating Departure"; // icon clock
                                        break;
                                    case ($eta_date < $current_date):
                                        echo "Delivered" . ' <i class="fas fa-check-circle text-success"></i> '; // icon check
                                        // echo "<br>" . date_format(date_create($this->shipment_info[0]->atd),"d M Y H:i");
                                        break;
                                    default:
                                        echo '<i class="fas fa-hourglass-half text-warning"></i> ' . "Pending"; // icon hour glass
                                        break;
                                }
                            ?>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-6">
                    <div class="small-box">
                        <div class="inner">
                            <strong><i class="fas fa-history text-primary"></i> Last Updated</strong>
                            <p><?php 
                                $date = date_create($this->shipment_info[0]->trigger_date);
                                echo date_format($date,"d M Y H:i:s");
                            ?></p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-6">
                    <div class="small-box">
                        <div class="inner">
                            <strong><i class="fa fa-map-marker text-primary"></i> Port of Loading</strong>
                            <p><?= $this->shipment_info[0]->port_loading; ?></p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-6">
                    <div class="small-box">
                        <div class="inner">
                            <strong><i class="fa fa-map-marker-alt text-primary"></i> Port of Discharge</strong>
                            <p><?= $this->shipment_info[0]->port_discharge; ?></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card card-primary card-outline card-outline-tabs">
    <div class="card-header p-0 border-bottom-0">
        <ul class="nav nav-tabs" id="custom-tabs-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="custom-tabs-info-tab" data-toggle="pill" href="#custom-tabs-info" role="tab" aria-controls="custom-tabs-info" aria-selected="true">Information</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-invoice-tab" data-toggle="pill" href="#custom-tabs-invoice" role="tab" aria-controls="custom-tabs-invoice" aria-selected="false">Invoice</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-timeline-tab" data-toggle="pill" href="#custom-tabs-timeline" role="tab" aria-controls="custom-tabs-timeline" aria-selected="false">Timeline</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="custom-tabs-documents-tab" data-toggle="pill" href="#custom-tabs-documents" role="tab" aria-controls="custom-tabs-documents" aria-selected="false">Documents</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="custom-tabs-tabContent">
            <div class="tab-pane fade active show" id="custom-tabs-info" role="tabpanel" aria-labelledby="custom-tabs-info-tab">
                <div class="row">

<!-- SECTION Shipment Details starts -->
<section class="col-lg-6 connectedSortable ui-sortable">
    <div class="card">
        <div class="card-header ui-sortable-handle" style="cursor: move;">
            <h3 class="card-title">
                <i class="fas fa-chart-pie mr-1"></i>
                Shipment Details
            </h3>
            <div class="card-tools m-0">
                <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-4">
                    <strong>Consol ID</strong>
                    <p><?= $this->shipment_info[0]->console_id; ?></p>
                </div>
                <div class="col-lg-4">
                    <strong>House Bill</strong>
                    <p><?= $this->shipment_info[0]->house_bill; ?></p>
                </div>
                <div class="col-lg-4">
                    <strong>Master Bill</strong>
                    <p><?= $this->shipment_info[0]->master_bill; ?></p>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4">
                    <strong><?= $transTitle ?> No.</strong>
                    <p><?= $this->shipment_info[0]->voyage_flight_num; ?></p>
                </div>
                <?php if($transMode == 'sea'): ?>
                <div class="col-lg-4">
                    <strong>Vessel Name</strong>
                    <p><?= $this->shipment_info[0]->vessel_name; ?></p>
                </div>
                <div class="col-lg-4">
                    <strong>Vessel Lloyds</strong>
                    <p><?= $this->shipment_info[0]->vesslloyds; ?></p>
                </div>
                <?php endif; ?>
            </div>
            <div class="row">
                <div class="col-lg-4">
                    <strong>Transport Mode</strong>
                    <p><?= $this->shipment_info[0]->transport_mode; ?></p>
                </div>
                <div class="col-lg-4">
                    <strong>Order Reference</strong>
                    <?php $order_number = json_decode($this->shipment_info[0]->order_number); ?>
                    <?php if(!is_array($order_number)): ?>
                        <?= $order_number; ?>
                    <?php else: ?>
                        <?php if(count($order_number) == 1): ?>
                            <p><?= (empty($order_number)) ? '<span class="text-danger"> - </span>' : $order_number[0]->OrderReference; ?></p>
                        <?php else: ?>
                            <div class="btn-group">
                                <button class="btn btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <?= (empty($order_number)) ? '<span class="text-danger"> - </span>' : $order_number[0]->OrderReference; ?>
                                </button>
                                <div class="dropdown-menu">
                                    <?php foreach ($order_number as $key => $order): ?>
                                    <li><a class="dropdown-item" href="#"><?= $order->OrderReference; ?></a></li>
                                    <?php endforeach; ?> 
                                </div>
                            </div>
                        <?php endif; ?>
                    <?php endif; ?>
                </div>
                <div class="col-lg-4">
                    <strong>Container Mode</strong>
                    <p><?= $this->shipment_info[0]->container_mode; ?></p>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <strong>Estimated Departure</strong>
                    <p><?php 
                        if($this->shipment_info[0]->etd == '1900-01-01 00:00:00.000'):
                            echo '-';
                        else: 
                            $date = date_create($this->shipment_info[0]->etd);
                            echo date_format($date,"d M Y H:i"); 
                        endif;
                    ?></p>
                </div>
                <div class="col-lg-6">
                    <strong>Estimated Arrival</strong>
                    <p><?php 
                        if($this->shipment_info[0]->eta == '1900-01-01 00:00:00.000'){
                            echo '-';
                        } else {
                            $date = date_create($this->shipment_info[0]->eta);
                            echo date_format($date,"d M Y H:i"); 
                        }
                    ?></p>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <strong>Actual Departure</strong>
                    <p><?php 
                        if($this->shipment_info[0]->atd == '1900-01-01 00:00:00.000'):
                            echo '-';
                        else: 
                            $date = date_create($this->shipment_info[0]->etd);
                            echo date_format($date,"d M Y H:i"); 
                        endif;
                    ?></p>
                </div>
                <div class="col-lg-6">
                    <strong>Actual Arrival</strong>
                    <p><?php 
                        if($this->shipment_info[0]->ata == '1900-01-01 00:00:00.000'){
                            echo '-';
                        } else {
                            $date = date_create($this->shipment_info[0]->eta);
                            echo date_format($date,"d M Y H:i"); 
                        }
                    ?></p>
                </div>
            </div>
            <?php $json_org = json_decode($this->shipment_info[0]->organization); ?>
            <!-- COLLAPSE Consignee starts -->
            <div class="collapse-control w-100 p-2 mb-2" style="background-color:#3778be !important;color:#FFFFFF !important;" data-toggle="collapse" data-target="#consignee" aria-expanded="true">
                <h5 class="d-inline-block">Consignee</h5>
                <span class="float-right mt-2"><?= $this->shipment_info[0]->consignee; ?>
                    <i class="chevron fa fa-chevron-down p-1" aria-hidden="true"></i>
                </span>
            </div>
            <dl id="consignee" class="row collapse">
                <?php
                if(!empty($json_org[0])) {
                    foreach ($json_org[0] as $key => $value) {
                        if(isset($value->AddressType)) {
                        if ($value->AddressType == "ConsigneePickupDeliveryAddress") {
                ?>
                <div class="col-lg-12">
                    <dt>Company Name:</dt>
                    <dd> <?= $value->CompanyName; ?> </dd>
                </div>
                <?php if(false): ?>
                <div class="col-lg-6">
                    <dt>Organization Code:</dt>
                    <dd> <?= $value->OrganizationCode; ?> </dd>
                </div>
                <?php endif; ?>
                <div class="col-lg-6">
                    <dt>Organization Name:</dt>
                    <dd><?= (empty($this->shipment_contact[0]->company_name)) ? '<span class="text-danger"> - </span>' : $this->shipment_contact[0]->company_name; ?></dd>
                </div>
                <div class="col-lg-6">
                    <dt>Delivery Address:</dt>
                    <dd> <?= $value->Address1; ?> </dd>
                </div>
                <?php }
                        }
                    }
                }
                ?>
                <div class="col-lg-6">
                    <dt>Delivery Date:</dt>
                    <dd>
                    <?php if(!empty($this->container_detail[0]->trans_estimated_delivery)) : ?> 
                    <?php if($this->container_detail[0]->trans_estimated_delivery == '1900-01-01 00:00:00.000'): ?>   
                    <span> - </span>
                    <?php else: ?>  
                    <span><?= date("d F Y H:i", strtotime($this->container_detail[0]->trans_estimated_delivery)); ?></span>
                    <?php endif; ?> 
                    <?php else: ?>
                    <span> - </span>
                    <?php endif; ?>
                    <?php 
                        // $date = date_create($this->shipment_info[0]->etd);
                        // echo date_format($date,"d F Y H:i"); 
                    ?>
                    </dd>
                </div>
                <div class="col-lg-6">
                    <dt>Delivery Place:</dt>
                    <dd><?= $this->shipment_info[0]->place_delivery; ?></dd>
                </div>
                <div class="col-lg-6">
                    <dt>Port of Loading: </dt>
                    <dd><?= $this->shipment_info[0]->port_loading; ?></dd>
                </div>
            </dl>
            <!-- COLLAPSE Consignee ends -->
            <!-- COLLAPSE Consignor starts -->
            <div class="collapse-control w-100 p-2 mb-2" style="background-color:#3778be !important;color:#FFFFFF !important;" data-toggle="collapse" data-target="#consignor" aria-expanded="true" >
                <h5 class="d-inline-block">Consignor</h5>
                <span class="float-right mt-2"><?= $this->shipment_info[0]->consignor; ?>
                <i class="chevron fa fa-chevron-down p-1" aria-hidden="true"></i>
                </span>
            </div>
            <dl id="consignor" class="row collapse">
                <?php
                if(!empty($json_org[0])) {
                    foreach ($json_org[0] as $key => $value) {
                        if(isset($value->AddressType)) {
                            if ($value->AddressType == "ConsignorPickupDeliveryAddress") {
                ?>
                <div class="col-lg-12">
                    <dt>Company Name:</dt>
                    <dd><?= $value->CompanyName; ?></dd>
                </div>
                <div class="col-lg-12">
                    <dt>Address:</dt>
                    <dd><?= $value->Address1; ?></dd>
                </div>
                <?php if(isset($value->Address2)): ?>
                <div class="col-lg-12">
                    <dt>Address 2:</dt>
                    <dd><?= $value->Address2; ?></dd>
                </div>
                <?php endif; ?>
                <div class="col-lg-6">
                    <dt>Receipt Place:</dt>
                    <dd><?= $this->shipment_info[0]->place_receipt; ?></dd>
                </div>
                <div class="col-lg-6">
                    <dt>Port of Discharge: </dt>
                    <dd><?= $this->shipment_info[0]->port_discharge; ?></dd>
                </div>
                <?php       }
                        }
                    }
                }
                ?>
            </dl>
            <!-- COLLAPSE Consignor ends -->
            <!-- COLLAPSE Container Details starts -->
            <div class="collapse-control w-100 p-2 mb-2" style="background-color:#3778be !important;color:#FFFFFF !important;" data-toggle="collapse" data-target="#container_details" aria-expanded="true" >
                <h5 class="d-inline-block">Container Details</h5>
                <span class="float-right mt-2"><?= $this->shipment_info[0]->shipment_num; ?>
                    <i class="chevron fa fa-chevron-down p-1" aria-hidden="true"></i>
                </span>
            </div>
            <div id="container_details" class="collapse">  
                <?php $container = json_decode($this->container_detail[0]->container); ?>
                <?php if(empty($container)): ?>   
                    <span> No Container Data </span>
                <?php else: ?>
                    <?php foreach ($container as $key => $value): ?>
                        <?php $value->no_data = '<span class="text-danger"> - </span>'; 
                        if(!empty($value->ContainerNumber)): ?>
                        <div class="collapse-control w-100 p-2 mb-2" style="background-color: #cdcdcd;" data-toggle="collapse" data-target="#cd-<?= $value->ContainerNumber ?>" aria-expanded="true" >
                            <span class="d-inline-block"><?= $value->ContainerNumber; ?>
                                <?php if(false): ?>
                                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                                <i class='fas fa-skull-crossbones' aria-hidden="true"></i>
                                <?php endif; ?>
                            </span>
                            <span class="float-right mt-2">
                                <i class="chevron fa fa-chevron-down p-1" aria-hidden="true"></i>
                            </span>
                        </div>
                        <dl id="cd-<?= $value->ContainerNumber ?>" class="row collapse">
                            <div class="col-lg-3">
                                <dt>Container Type:</dt>
                                <dd><?= $value->ContainerType->Code; ?></dd>
                            </div>
                            <?php if($transMode == 'sea'): ?>
                            <div class="col-lg-3">
                                <dt>Delivery Mode:</dt>
                                <dd><?= $value->DeliveryMode; ?></dd>
                            </div>
                            <?php endif; ?>
                            <div class="col-lg-3">
                                <dt>Gross Wt.:</dt>
                                <dd><?= $value->GrossWeight; ?></dd>
                            </div>
                            <div class="col-lg-3">
                                <dt>Volume:</dt>
                                <dd><?php
                                // $volume = $this->shipment_info[0]->totalvolume . "m³";
                                $volume = $value->VolumeCapacity;
                                // $length = floatval($value->length);
                                // $width = floatval($value->width);
                                // $height = floatval($value->height); 
                                // $volume = $length * $width * $height;
                                $unit = (strpos($value->VolumeUnit->Description, 'Metres')) ? "m³" :  " ";
                                echo number_format($volume, 2, '.', ',') . ' ' . $unit; ?></dd>
                            </div>
                            <div class="col-lg-3">
                                <dt>Storage Date:</dt>
                                <dd><?= (!empty($value->FCLStorageCommences)) ? $value->FCLStorageCommences : $value->no_data; ?></dd>
                            </div>
                            <?php if($transMode == 'sea'): ?>
                            <div class="col-lg-3">
                                <dt>Empty Req. By:</dt>
                                <dd><?= (!empty($value->value->EmptyRequired)) ? $value->value->EmptyRequired : $value->no_data; ?></dd>
                            </div>
                            <div class="col-lg-6">
                            </div>
                            <div class="col-lg-6">
                                <dt>Gate In (Export): </dt>
                                <dd><?= date_format(date_create($value->FCLWharfGateIn),"d M Y H:i:s"); ?></dd>
                            </div>
                            <div class="col-lg-6">
                                <dt>Gate Out (Import): </dt>
                                <dd><?= date_format(date_create($value->FCLWharfGateOut),"d M Y H:i:s"); ?></dd>
                            </div>
                            <div class="col-lg-6">
                                <dt>FCL Available: </dt>
                                <dd><?= date_format(date_create($value->FCLAvailable),"d M Y H:i:s"); ?></dd>
                            </div>
                            <div class="col-lg-6">
                                <dt>FCL Loaded In: </dt>
                                <dd><?= date_format(date_create($value->FCLUnloadFromVessel),"d M Y H:i:s"); ?></dd>
                            </div>
                            <?php endif; ?>
                        </dl>
                        <?php endif; ?>
                    <?php endforeach; ?>
                <?php endif; ?>
            </div>
            <!-- COLLAPSE Container Details ends -->
        </div>
    </div>
</section>
<!-- SECTION Shipment Details ends -->

<!-- SECTION Routing Details starts -->
<section class="col-lg-6 connectedSortable ui-sortable">
    <div class="card">
        <div class="card-header p-0 border-bottom-0">
            <ul class="nav nav-tabs" id="custom-tabs-three-tab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="custom-tabs-three-home-tab" data-toggle="pill" href="#custom-tabs-three-home" role="tab" aria-controls="custom-tabs-three-home" aria-selected="false"><i class="fas fa-map mr-1"></i>
                    Route Details</a>
                </li>
                <?php if(!empty($this->shipment_info[0]->vesslloyds)) : ?>
                <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-three-profile-tab" data-toggle="pill" href="#custom-tabs-three-profile" role="tab" aria-controls="custom-tabs-three-profile" aria-selected="false"><i class="fas fa-bullseye mr-1"></i>
                    GPS Tracking</a>
                </li>
                <?php endif; ?>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="custom-tabs-three-tabContent">
                <div class="tab-pane fade show active" id="custom-tabs-three-home" role="tabpanel" aria-labelledby="custom-tabs-three-home-tab">
                    <div id="chartdiv" class="" style="position: relative; height: 300px;">
                        <div class="spinner-border" role="status" style="position: absolute;bottom: 50%;right: 50%;">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="custom-tabs-three-profile" role="tabpanel" aria-labelledby="custom-tabs-three-profile-tab">
                    <div style="background-color:white;position:relative;top:-15px;z-index: 1">&nbsp;</div>
                    <?php if(!empty($this->shipment_info[0]->vesslloyds)) : ?>
                    <iframe style="position: relative;top: -35px;" name="vesselfinder" id="vesselfinder" src="https://www.vesselfinder.com/aismap?zoom=undefined&amp;lat=undefined&amp;lon=undefined&amp;width=100%&amp;height=500&amp;names=false&amp;imo=<?php echo $this->shipment_info[0]->vesslloyds;?>&amp;track=false&amp;fleet=false&amp;fleet_name=false&amp;fleet_hide_old_positions=false&amp;clicktoact=false&amp;store_pos=false&amp;ra=livetracking_" width="100%" height="352" frameborder="0"></iframe>
                    <?php endif; ?>
                </div>
                <div class="col-md-12">
                    <div id="accordion" class="mt-2">
                        <?php if($this->shipment_info[0]->route_leg !== "[]"):
                            $json = json_decode($this->shipment_info[0]->route_leg);
                            if(!empty($json)):
                        ?>
                            <?php foreach ($json as $key => $value): ?>
                            <div class="card">
                                <div class="card-header" id="heading<?=$key;?>">
                                    <h5 class="mb-0">
                                    <div class="container btn btn-link" data-toggle="collapse" data-target="#collapse<?= $key; ?>" aria-expanded="true" aria-controls="collapse<?= $value->LegOrder; ?>">
                                            <div class="row">
                                                <div class="col-sm-5"><?php echo $value->PortOfLoading->Name; ?></div>
                                                <div class="col-sm-2 text-center"><i class="fas fa-arrow-right"></i></div>
                                                <div class="col-sm-5">
                                                    <div class="btn-group">
                                                        <button style="color:#007bff;" class="btn btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <?php echo $value->PortOfDischarge->Name; ?> 
                                                        </button>
                                                        <div class="dropdown-menu">
                                                            <li class="dropdown-item"><?= (!empty($value->BookingStatus))?$value->BookingStatus->Description:" - "; ?> 
                                                            (<?= (!empty($value->BookingStatus))?$value->BookingStatus->Code:" - "; ?>)</li>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </h5>
                                </div>

                                <div id="collapse<?= $key; ?>" class="collapse" aria-labelledby="heading<?=$key;?>" data-parent="#accordion">
                                    <div class="card-body">
                                        <?php if(false): ?>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <strong>Status</strong>
                                                <p class="<?= (!empty($value->BookingStatus))?strtolower($value->BookingStatus):" - "; ?>">
                                                <?= (!empty($value->BookingDesc))?$value->BookingDesc:" - "; ?> 
                                                (<?= (!empty($value->BookingStatus))?$value->BookingStatus:" - "; ?>)
                                            </p>
                                            </div>
                                        </div>
                                        <?php endif; ?>
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <strong>Routing Leg 
                                                <?= (!empty($value->LegType))?"(".$value->LegType.")":""; ?>
                                                </strong>
                                                <p><?= $value->LegOrder; ?> of <?= count($json) ?></p>
                                            </div>
                                            <?php if(false): ?>
                                            <div class="col-lg-4">
                                                <strong>Leg Type</strong>
                                                <p><?= $value->LegType; ?></p>
                                            </div>
                                            <?php endif; ?>
                                            <div class="col-lg-6">
                                                <strong>Vessel Name</strong>
                                                <p><?= (!empty($value->VesselName))?"(".$value->VesselName.")":"";?></p>
                                            </div>
                                        </div>
                                        <?php if(false): ?>
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <strong>Origin Port</strong>
                                                <p><?=  $value->PortOfLoading->Name ?></p>
                                            </div>
                                            <div class="col-lg-6">
                                                <strong>Destination Port</strong>
                                                <p><?=  $value->PortOfDischarge->Name ?></p>
                                            </div>
                                        </div>
                                        <?php endif; ?>
                                        <div class="row">
                                            <?php if(isset($value->EstimatedDeparture)): ?>
                                            <div class="col-lg-6">
                                                <strong>Estimated Departure </strong>
                                                <?php if(!empty($value->EstimatedDeparture)): ?>
                                                <p><?= ($value->EstimatedDeparture == '01 Jan 1900 00:00.000') ? '-' : date("d F Y H:i", strtotime($value->EstimatedDeparture)); ?></p>
                                                <?php else: ?>
                                                <p> - </p>
                                                <?php endif; ?>
                                            </div>
                                            <?php endif; ?>
                                            <?php if(isset($value->EstimatedArrival)): ?>
                                            <div class="col-lg-6">
                                                <strong>Estimated Arrival</strong>
                                                <?php if(!empty($value->EstimatedArrival)): ?>
                                                <p><?= ($value->EstimatedArrival == '01 Jan 1900 00:00.000') ? '-' : date("d F Y H:i", strtotime($value->EstimatedArrival)); ?></p>
                                                <?php else: ?>
                                                <p> - </p>
                                                <?php endif; ?>
                                            </div>
                                            <?php endif; ?>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <strong>Carrier Name</strong>
                                                <p><?= (!empty($value->Carrier->CompanyName))?$value->Carrier->CompanyName:" - "; ?></p>
                                            </div>
                                            <div class="col-lg-12">
                                                <strong>Carrier Address</strong>
                                                <p><?= (!empty($value->Carrier->Address1))?$value->Carrier->Address1.", ".$value->Carrier->City.", ".$value->Carrier->Country->Code:" - "; ?></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <?php if(!empty($value->LCLAvailability)) : ?>
                                            <div class="col-lg-4">
                                                <strong>CFS Availability</strong>
                                                <p><?= date("d F Y H:i", strtotime($value->LCLAvailability)); ?></p>
                                            </div>
                                            <?php endif; ?>
                                            <?php if(!empty($value->LCLStorageDate)) : ?>
                                            <div class="col-lg-4">
                                                <strong>CFS Storage Date</strong>
                                                <p><?= date("d F Y H:i", strtotime($value->LCLStorageDate)); ?></p>
                                            </div>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <?php endforeach; ?>
                            <?php else: ?>
                                <span>No route data</span>
                            <?php endif; ?>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- SECTION Routing Details ends -->

<!-- SECTION Order Details ends -->
<section class="col-lg-12 connectedSortable ui-sortable">
    <div class="card">
        <div class="card-header ui-sortable-handle" style="cursor: move;">
            <h3 class="card-title">
                <i class="fas fa-file-invoice  mr-1"></i>
                 Order View
            </h3>
            <div class="card-tools m-0">
                <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body2" style="overflow: scroll;">
            <table id="orders" class="table table-hover table-head-fixed text-nowrap">
                <thead>
                    <tr>
                        <th>Order Number</th>
                        <th>Ship/Dec No.</th>
                        <th>Order Date</th>
                        <th>Pre Advice</th>
                        <th>Buyer</th>
                        <th>Supplier</th>
                        <th>Transport Mode</th>
                        <th>Container Mode</th>
                        <th>Goods Origin</th>
                        <th>Goods Destination</th>
                        <th>Load Port</th>
                        <th>Dischargte Port</th>
                        <th>Packs</th>
                        <th>Type</th>
                        <th>Volume</th>
                        <th>UV</th>
                        <th>Weight</th>
                        <th>UW</th>
                        <th>Req. in Stock</th>
                        <th>Req. in Works</th>
                        <th>H.Bill</th>
                        <th>M.BIll</th>
                    </tr>
                </thead>   
            </table>
        </div>
    </div>
</section>
<!-- SECTION Order Details ends -->
                </div>
            </div>
            <div class="tab-pane fade" id="custom-tabs-invoice" role="tabpanel" aria-labelledby="custom-tabs-invoice-tab">
                <div class="row">
                    <!-- SECTION Invoice Details ends -->
                    <section class="col-lg-12 connectedSortable ui-sortable">
                        <div class="card">
                            <div class="card-header ui-sortable-handle" style="cursor: move;">
                                <h3 class="card-title">
                                    <i class="fas fa-file-invoice"></i>
                                    Invoice Details
                                </h3>
                            <div class="card-tools m-0">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body table-responsive p-0 ttable" style="height: auto;">
                            <table id="invoice" class="table table-hover table-head-fixed text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Trans.#</th>
                                        <th>Type</th>
                                        <th>Debtor</th>
                                        <th>Job Inv.#</th>
                                        <th>Post Date</th>
                                        <th>Invoice Date</th>
                                        <th>Fully Paid Date</th>
                                        <th>Invoice Amount</th>
                                        <th>Outstanding Balance</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Trans.#</th>
                                        <th>Type</th>
                                        <th>Debtor</th>
                                        <th>Job Inv.#</th>
                                        <th>Post Date</th>
                                        <th>Invoice Date</th>
                                        <th>Fully Paid Date</th>
                                        <th>Invoice Amount</th>
                                        <th>Outstanding Balance</th>
                                        <th>Status</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </section>
                    <!-- SECTION Invoice Details ends -->
                </div>
            </div>
            <div class="tab-pane fade" id="custom-tabs-timeline" role="tabpanel" aria-labelledby="custom-tabs-timeline-tab">
                <div class="row"> 
                    <span class="text-center">Coming soon...</span> 
                </div>
            </div>
            <div class="tab-pane fade" id="custom-tabs-documents" role="tabpanel" aria-labelledby="custom-tabs-documents-tab">
                <div class="row">
                    <div class="col-md-12">
                        <!-- Document starts -->
                        <table id="doc_table" class="table table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Document Type</th>
                                    <th>Status</th>
                                    <th>Date Received</th>
                                    <th>Comments</th>
                                </tr>
                            </thead>
                        </table>
                        <canvas id="donutChart" style="display:none; min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        <div class="container-fluid">
                            <?php if(false): ?>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card mt-4">
                                        <div class="card-header">Document Status</div>
                                        <div class="card-body">
                                            <div class="chart-container pie-chart">
                                                <canvas id="pie_chart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card mt-4">
                                        <div class="card-header">Document Request</div>
                                        <div class="card-body">
                                            <div class="chart-container pie-chart">
                                                <canvas id="doughnut_chart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card mt-4 mb-4">
                                        <div class="card-header">Comments</div>
                                        <div class="card-body">
                                            <div class="chart-container pie-chart">
                                                <canvas id="bar_chart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <?php endif; ?>
                        </div>
                        <!-- Document ends -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div>
<style>
/* .small-box .inner {
    min-height: 105px !important;
} */
.amcharts-myline path {
  stroke-linejoin: round;
  stroke-linecap: round;
  stroke-dasharray: 500%;
  stroke-dasharray: 0.25rem; /* fixes IE prob */
  stroke-dashoffset: 0; /* fixes IE prob */
  -webkit-animation: am-draw 100s;
  animation: am-draw 100s;
}
@-webkit-keyframes am-draw {
  0% {
    stroke-dashoffset: 500%;
  }
  100% {
    stroke-dashoffset: 0%;
  }
}
@keyframes am-draw {
  0% {
    stroke-dashoffset: 500%;
  }
  100% {
    stroke-dashoffset: 0%;
  }
}
/* Data Tables */
table.dataTable {
    margin-top: 0 !important;
}
table.dataTable>tbody>tr.child ul.dtr-details {
    width: 100%;
}
#DataTables_Table_0_processing{
    position: fixed;
    top: 50%;
    left: 50%;
    z-index: 1000;
    display: block;
    background: transparent;
    border: 0;
    border-radius: 0;
    box-shadow: none;
}
.dataTables_empty{
    text-align: center;
}
.dataTables_filter{
    display: none !important;
}
.dataTables_wrapper {
    position: relative;
}
.dataTables_info {
    padding-left: 1em;
}
.dataTables_paginate {
    padding-right: 1em;
}
#invoice_length {
    display: none;
}
#chartdiv > div > svg > g > g:nth-child(2) > g:nth-child(1) > g:nth-child(2) > g:nth-child(1) > g:nth-child(2) > g:nth-child(1) > g > g:nth-child(6) > g > g:nth-child(3) > g > g:nth-child(4) > g > g{
    transform: rotate(-90deg);
}
.shipment-num {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
/* Route Status */
.cnf {
    color: #28a745!important;
}
.pnd {
    color: #ffc107!important;
}
.pln {
    color: #17a2b8!important;
}
.err {
    color: #dc3545!important;
}
</style>
<script src="/js/map.js"></script>
<script>
var cnt = 0;
var stoper = 0;
var keycount = 0;
var promises = [];
var route = JSON.parse(<?= json_encode($this->shipment_info[0]->route_leg) ?>);
var combineRoute = [];
var pointObject = [];
var uidHolder = '';
var transImage = "<?= $transImage ?>";
var transmode = "<?=$transMode?>";
var tooltipHTML = `<center><strong>{vessel}</strong></center>
    <hr />
    <div class="row">
        <div class="col-lg-6">
            <table>
                <tr>
                    <th align="left">Route</th>
                    <td>{order}</td>
                </tr>
                <tr>
                    <th align="left">Port: </th>
                    <td>{title}</td>
                </tr>
                <tr>
                    <th align="left">Point</th>
                    <td>{type}</td>
                </tr>
            </table>
        </div>
        <div class="col-lg-6">
            <img width="200px" src="https://cargomation.com/img/vessel/{vessel}.jpg" onerror="this.onerror=null;this.src='https://cargomation.com/img/vessel/noimg.png';">
        </div>
    </div>
    <hr />
    <center>
        <input class="btn btn-default btn-xs mb-2" type="button" value="More info" onclick="routeBtn({order})" />
    </center>`;

var loader = '<div id="loader-wrapper" class="d-flex justify-content-center">' +
    '<div class="spinner-border" role="status">' +
    '<span class="sr-only">Loading...</span>' +
    '</div>' +
    '</div>';

$(document).ready(function() { 
    if(localStorage.getItem('countryLoc') === null){
        $.getJSON('/settings/countryLocation.json', function(data) {
            localStorage.setItem('countryLoc', JSON.stringify(data));
        }).fail(function(){
            console.log("Error");
        }); 
   }
    var countryLoc = JSON.parse(localStorage.getItem('countryLoc'));

    $(".collapse").on("hidden.bs.collapse", toggleChevron);
    $(".collapse").on("shown.bs.collapse", toggleChevron);
    $.each(route, function(key, value) {
        combineRoute.push({
            "order": parseInt(value.LegOrder),
            "point": value.PortOfLoading.Name,
            "vessel": value.VesselName,
            "type": "Origin",
            "keycount":keycount++,
            "code": value.PortOfLoading.Code
        });
        combineRoute.push({
            "order": parseInt(value.LegOrder),
            "point": value.PortOfDischarge.Name,
            "vessel": value.VesselName,
            "type": "Destination",
            "keycount":keycount++,
            "code":value.PortOfDischarge.Code
        });
    });
    $.each(combineRoute, function(key, value) {
        // If point has back slash
        if(value.point.includes("/")) {
            value.point = value.point.split('/')[1];
        }
        var data = null;
        var promise  = $.ajax({
            url: document.location.origin + '/shipment/getCity/',
            type: "POST",
            dataType: "json",
            data: { location: value.point },
            success: function (res) {
                var cCode = value.code.substr(0, 2);
                data = res;
                if(data.length > 0) {
                    var latitude = countryLoc[cCode].latitude//data[0].lat
                    var longitude = countryLoc[cCode].longitude//data[0].lng;

                    uidHolder =  <?= json_encode($this->shipment_info[0]->user_id) ?>;
                    pointObject.push({
                        "latitude": parseFloat(latitude),
                        "longitude":parseFloat( longitude),
                        "title": value.point,
                        "order": value.order,
                        "vessel": value.vessel,
                        "type": value.type,
                        "keycount":value.keycount
                    });
                    cnt++;
                }
            }
        }); 
        promises.push(promise);
    });
    $.when.apply($, promises).done(function() {
        pointObject.sort((a, b) => { return a.keycount - b.keycount;});
        if(transmode === "sea"){
            $.getScript("/js/shipment/sea.map.js", function() {}); 
        }else{ 
            var uiarray = ['207'];
            if(jQuery.inArray(uidHolder, uiarray) !== -1){
                $.getScript("/js/shipment/sea.map.js", function() {}); 
            }else{
                $.getScript("/js/shipment/air.map.js", function() {}); 
            }
        }
    }).fail(function() {
        console.log("fail");
    });
    $('#invoice').DataTable( {
        processing: true,
        autoWidth: false,
        responsive: {
            details: {
                display: $.fn.dataTable.Responsive.display.modal( {
                    header: function ( row ) {
                        var data = row.data();
                        console.log(data);
                        return 'Details for '+data.job_invoicenum+' - '+data.transaction_num;
                    }
                }),
                renderer: $.fn.dataTable.Responsive.renderer.tableAll( {
                    tableClass: 'table'
                })
            }
        },
        language: {
            processing: '<center><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></center>'
        },
        serverSide: true,
        serverMethod: 'post',
        ajax: {
            url: 'invoice/getInvoiceData',
            data: function(outData){
                outData.shipment_num = "<?= $this->shipment_info[0]->shipment_num; ?>";
                // console.log(outData);
                return outData;
            },
            dataFilter:function(inData){
                // what is being sent back from the server (if no error)
                // console.log(inData);
                return inData;
            },
            error:function(err, status){
                // what error is seen(it could be either server side or client side.
                console.log(err);
            },
        },
        columns: [
            { data: 'transaction_num', defaultContent: "-" },
            { data: 'inv_type', defaultContent: "-" },
            { data: 'debtor', defaultContent: "-" },
            { data: 'job_invoicenum', defaultContent: "-" },
            { data: 'post_date', defaultContent: "-",
                render: function(data, type, row){
                    return moment(data).format("DD MMM YYYY");
                }
            },
            { data: 'invoice_date', defaultContent: "-",
                render: function(data, type, row){
                    return moment(data).format("DD MMM YYYY");
                }
            },
            { data: 'fullypaid_date', defaultContent: "-",
                render: function(data, type, row){
                    var date = moment(data).format("DD MMM YYYY");
                    if (date !== '01 Jan 1900') {
                        return moment(data).format("DD MMM YYYY");
                    }
                    return '-';
                }
            },
            { data: 'invoice_amount', defaultContent: "-",
                render: $.fn.dataTable.render.number( ',', '.', 2, '$' )
            },
            { data: 'outstanding_amount', defaultContent: "-",
                render: $.fn.dataTable.render.number( ',', '.', 2, '$' )
            },
            { data: 'outstanding_amount', defaultContent: "Unpaid",
                render: function(data, type, row){
                    if (data <= '0.00000') {
                        return 'Paid';
                    }
                    return 'Unpaid';
                }
            }
        ],
        // initComplete: function( settings, json ) {
        // },
        // drawCallback: function( settings, json ) {
        // }
    });
    $('.shipment-num').tooltip();
    // makechart();
	function makechart() {
		$.ajax({
			url:"document/getDocumentData/<?= $this->shipment_info[0]->shipment_num; ?>",
			method:"POST",
			data:{action:'fetch', column:'type'},
			dataType:"JSON",
			success:function(data) {
				var type = [];
				var total = [];
				var color = [];

				for(var count = 0; count < data.length; count++) {
					type.push(data[count].type);
					total.push(data[count].total);
					color.push(data[count].color);
                    // color.push('#' + Math.floor(Math.random()*16777215).toString(16));
				}

				var donutData = {
					labels:type,
					datasets:[
						{
							label:'Document',
							backgroundColor:color,
							color:'#fff',
							data:total
						}
					]
				};

                var donutChartCanvas = $('#donutChart').get(0).getContext('2d')

                var donutOptions     = {
                    maintainAspectRatio : false,
                    responsive : true,
                }

                new Chart(donutChartCanvas, {
                    type: 'doughnut',
                    data: donutData,
                    options: donutOptions
                });


			}
		})
	}
    function toggleChevron(e) {
        $(e.target)
            .prev(".collapse-control")
            .find("i.chevron")
            .toggleClass("fa-chevron-down fa-chevron-up");
    }

    //  $("#custom-tabs-info-tab").on('click',function(){
    //     if(transmode === "Sea"){
    //             $.getScript("/js/shipment/sea.map.js", function() {}); 
    //         }else{ 
    //             $.getScript("/js/shipment/air.map.js", function() {}); 
    //         }
    //  });
 
    $('#doc_table').DataTable( {
        processing: true,
        language: {
            processing: '<center><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></center>'
        },
        serverSide: true,
        serverMethod: 'post',
        ajax: {
            url: 'document/getDocumentData',
            data: function(outData){
                outData.shipment_num = "<?= $this->shipment_info[0]->shipment_num; ?>";
                // console.log(outData);
                return outData;
            },
            dataFilter:function(inData){
                // what is being sent back from the server (if no error)
                // console.log(inData);
                return inData;
            },
            error:function(err, status){
                // what error is seen(it could be either server side or client side.
                console.log(err);
            },
        },
        columns: [
            { data: 'type', defaultContent: "OTHER" },
            { data: 'status', defaultContent: "-" },
            { data: 'saved_date', defaultContent: "-",
                render: function(data, type, row){
                    if(type === "sort" || type === "type"){
                        return data;
                    }
                    return moment(data).format("DD MMM YYYY HH:mm:ss");
                }
            },
            { data: 'doc_comments', defaultContent: "-" }
        ],
        initComplete: function( settings, json ) {
        },
        drawCallback: function( settings, json ) {
            // Button Comment
            $('button.file-comment, span.file-comment').click(function (ev) {
                var doc_status = $(this).data("doc_status");
                var doc_id = $(this).data("doc_id");
                //$('#document-upload, #document-comment').toggle();
                ev.preventDefault();
                // var target = $(this).attr("href");
                // var target = "document/comment/" + doc_id + "/" + doc_status;
                var url = "document/comment/" + doc_id + "/view/" + doc_status;
                console.log(url);
                // load the url and show modal on success
                // preloader(url);
                $("#shipmentModal .modal-body").append(loader);
                // load the url and show modal on success
                $("#shipmentModal .modal-body").load(url,
                function (response, status, xhr) {
                    if (xhr.status == 200) {
                        $('#loader-wrapper').remove();
                        $("#shipmentModal").modal("show");
                    } else {
                        alert("Error: " + xhr.status + ": " + xhr.statusText);
                        $('#loader-wrapper').remove();
                    }
                });
                // $('#document_action, #go_back').toggle();
            });
        }
    });

    //orders code  goes here
    var table = $('#orders').DataTable( {
        // "serverSide": true,
        "autoWidth": false,
        "ajax": document.location.origin+"/order/getOrderByShipment/",
        "ordering": true,
        "bPaginate":true,
        "responsive:":true,
        "bLengthChange": false,
        "sPaginationType":"full_numbers",
        "iDisplayLength": 8,
        "columns": [
            { "data": "order_number" },
            { "data": "ship_num" },
            { "data": "order_date" },
            { "data": "pre_advice" },
            { "data": "buyer" },
            { "data": "supplier" },
            { "data": "transport_mode" },
            { "data": "container_mode" },
            { "data": "goods_origin" },
            { "data": "good_destination" },
            { "data": "load_port" },
            { "data": "discharge_port" },
            { "data": "packs" },
            { "data": "type" },
            { "data": "volume" },
            { "data": "uv" },
            { "data": "weight" },
            { "data": "uw" },
            { "data": "req_stock" },
            { "data": "req_work" },
            { "data": "h_bill" },
            { "data": "m_bill" },
        ],
        "order": [[1, 'desc']],  
    });
});
</script>
